[![](https://img.shields.io/crates/v/elf_loader.svg)](https://crates.io/crates/elf_loader)
[![](https://img.shields.io/crates/d/elf_loader.svg)](https://crates.io/crates/elf_loader)
[![license](https://img.shields.io/crates/l/elf_loader.svg)](https://crates.io/crates/elf_loader)
# elf_loader
ä¸€ä¸ªæä¾›å¼‚æ­¥åŠ è½½æ¥å£ï¼Œèƒ½å¤Ÿä»å†…å­˜ã€æ–‡ä»¶åŠ è½½elfåŠ¨æ€åº“çš„Ruståº“ã€‚  

[æ–‡æ¡£](https://docs.rs/elf_loader/)

# ç‰¹æ€§
### âœ¨ å¯ä»¥åœ¨ `no_std` ç¯å¢ƒä¸­å·¥ä½œ âœ¨
æ­¤åŒ…æä¾›äº†ä¸€ä¸ªä¸ä½¿ç”¨ä»»ä½• std ç‰¹æ€§çš„ elf åŠ è½½æ¥å£ï¼Œå› æ­¤å¯ä»¥åœ¨å†…æ ¸å’ŒåµŒå…¥å¼è®¾å¤‡ç­‰`no_std`ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

### âœ¨ é€Ÿåº¦å¿« âœ¨
è¯¥crateå……åˆ†åˆ©ç”¨äº†rustçš„ä¸€äº›ç‰¹æ€§ï¼Œå¯ä»¥ç”Ÿæˆæ€§èƒ½ä¼˜å¼‚çš„ä»£ç ã€‚

### âœ¨ éå¸¸å®¹æ˜“ç§»æ¤ï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ âœ¨
å¦‚æœæ‚¨æƒ³è¦ç§»æ¤æ­¤ crateï¼Œåˆ™åªéœ€ä¸ºæ‚¨çš„å¹³å°å®ç° `Mmap` ç‰¹å¾å³å¯ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥ä½¿ç”¨hookå‡½æ•°åŸºäºæ­¤ crate å®ç°å…¶ä»–åŠŸèƒ½ã€‚

### âœ¨ è½»é‡åŒ– âœ¨
åœ¨ä½¿ç”¨æœ€å°‘featureçš„æƒ…å†µä¸‹ï¼Œæœ¬åº“åªä¾èµ– `elf`, `cfg-if`, å’Œ `bitflags` è¿™é¢å¤–çš„ä¸‰ä¸ªåº“ã€‚

### âœ¨ ç¼–è¯‘æœŸæ£€æŸ¥ âœ¨
åˆ©ç”¨Rustçš„ç”Ÿå‘½å‘¨æœŸæœºåˆ¶ï¼Œåœ¨ç¼–è¯‘æœŸæ£€æŸ¥åŠ¨æ€åº“çš„ä¾èµ–åº“æ˜¯å¦è¢«æå‰é”€æ¯ï¼Œä»¥åŠç¬¦å·æ‰€å±çš„åŠ¨æ€åº“æ˜¯å¦å·²ç»è¢«é”€æ¯ã€‚

# ç”¨é€”
å®ƒå®ç°äº†åŠ è½½elfæ–‡ä»¶çš„é€šç”¨æ­¥éª¤ï¼Œå¹¶ç•™ä¸‹äº†æ‰©å±•æ¥å£ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å®ƒå®ç°è‡ªå·±çš„å®šåˆ¶åŒ–loaderã€‚

# ç‰¹æ€§

| ç‰¹æ€§      |  æè¿°  |
| --------- | ----------------- |
| fs        |  å¯ç”¨å¯¹æ–‡ä»¶ç³»ç»Ÿçš„æ”¯æŒ        						|
| use-libc  |  ä½¿ç”¨libcä½œä¸ºåç«¯ï¼Œå¦åˆ™ç›´æ¥ä½¿ç”¨linux syscalls		|
| mmap      |  åœ¨åŠ è½½elfæ–‡ä»¶æ—¶ï¼Œä½¿ç”¨æœ‰mmapçš„å¹³å°ä¸Šçš„é»˜è®¤å®ç°  	| 
| version   |  åœ¨è§£æç¬¦å·æ—¶ä½¿ç”¨ç¬¦å·çš„ç‰ˆæœ¬ä¿¡æ¯     |

# ç¤ºä¾‹
## mini-loader
æœ¬ä»“åº“æä¾›äº†ä¸€ä¸ªä½¿ç”¨`elf_loader`å®ç°[mini-loader](https://github.com/weizhiao/elf_loader/tree/main/mini-loader)çš„ä¾‹å­ã€‚miniloaderå¯ä»¥åŠ è½½pieæ–‡ä»¶ï¼Œç›®å‰åªæ”¯æŒ`x86_64`ã€‚  

åŠ è½½ls:
```shell 
$ cargo build --release -p mini-loader --target=x86_64-unknown-none
$ ./mini-loader /bin/ls
```
éœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»ä½¿ç”¨releaseå‚æ•°ç¼–è¯‘mini-loaderã€‚

## dlopen-rs
[dlopen-rs](https://crates.io/crates/dlopen-rs)ä¹Ÿæ˜¯åŸºäº`elf_loader`åº“å®ç°çš„ã€‚å®ƒå®ç°äº†dlopençš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æ‰“å¼€åŠ¨æ€åº“ã€‚

# æœªå®Œæˆ
* æ”¯æŒæ›´å¤šçš„CPUæŒ‡ä»¤é›†ï¼ˆç›®å‰åªæ”¯æŒAArch64ï¼ŒRiscv64ï¼ŒX86-64ï¼‰ã€‚
* å®Œå–„å¯¹DT_FLAGSæ ‡å¿—ä½çš„æ”¯æŒã€‚
* å®Œå–„æ³¨é‡Šå’Œæ–‡æ¡£ã€‚  
* å¢åŠ ç¤ºä¾‹ï¼ˆæ¯”å¦‚ä½¿ç”¨å¼‚æ­¥æ¥å£åŠ è½½åŠ¨æ€åº“çš„ç¤ºä¾‹ï¼‰ã€‚
* ä¸ºç¤ºä¾‹mini-loaderæ”¯æŒæ›´å¤šçš„æŒ‡ä»¤é›†ã€‚
.....

# è¡¥å……
å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜å¯ä»¥åœ¨ GitHub ä¸Šæå‡ºé—®é¢˜ï¼Œååˆ†æ¬¢è¿å¤§å®¶ä¸ºæœ¬åº“æäº¤ä»£ç ä¸€èµ·å®Œå–„`elf_loader`çš„åŠŸèƒ½ã€‚ğŸ˜Š